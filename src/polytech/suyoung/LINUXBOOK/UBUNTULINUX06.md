# 우분투 리눅스 6장 요약

# 리눅스 부팅 순서 알아보기

## 부팅이란?

운영체제가 활성화되는 과정

부팅의 20단계가 있는데, 4단계 이후부터 알아보고자 한다. 

## 컴퓨터의 부팅 순서

1. 컴퓨터에 전원 넣기
2. ROM-BIOS에 저장되어 있는 BIOS 프로그램을 메모리로 적재
3. CPU가 메모리의 사전 지정된 프로그램을 읽어서 실행
4. 로드된 BIOS 프로그램이 시스템 하드웨어 검사
5. 하드웨어 검사가 성공하면 후 디스크 MBR(디스크 파티션의 첫번째 섹터로, 시동코드를 담고 있음)의 부트로더를 메모리에 적재 후 BIOS 종료
6. 부트로더가 운영체제에 필요한 커널 프로그램 검사 및 환경 설정에 따른 실행
7. 운영체제 선택화면 표시 후 대기 카운트 동작, 선택화면이 없으면 기본 커널 적재
8. 커널이 SWAPPER 프로세스를 호출하여 각종 드라이버를 초기화
9. PID(프로세스 식별 번호)가 0번인 SWAPPER가 PID 1번인 /sbin/init을 실행하고 swapping 기능 수행
10. init 프로세스는 /etc/init.d/rcS에 정의된 스크립터를 순차적으로 실행
11. init 프로세스가 /sbin/mingetty를 실행하여 가상 터미널을 생성
12. init 프로세스가 /bin/login을 실행하여 가상 터미널에 로그인 프롬프트를 표시
13. 사용자 입력에 따라 /etc/passwd 파일에서 계정 확인 후 쉘 프로그램 호출 
14. 쉘 프로그램이 /etc/profile 및 홈 디렉터리의 환경 설정 파일 실행
15. 쉘 프로그램이 사용자 명령어 입력 대기 프롬프트 표시
16. 쉘 프로그램이 사용자 명령어를 해석하여 내부/외부 명령어 분류
17. 내부 명령어는 자체 처리하고 외부 명령어는 경로 설정에 따른 프로그램 호출
18. 로그아웃 명령을 만나면 로그아웃 스크립터 실행 후 쉘 종료
19. 시스템 종료 명령을 만나면 시스템 종료를 위한 각 프로그램 프로세스 종료
20. 로그아웃일 경우 쉘 프로그램만 종료하여 login 프로그램 다시 활성

## 부트로더

부트로더는 소프트웨어의 시작점이다. 

부트로더는 CMOS(컴퓨터에서 CMOS는 메인보드에 위치한 작은 칩으로, 컴퓨터의 기본 설정 정보를 저장하는 데 사용됨. CMOS에는 BIOS 설정, 부팅 장치의 우선순위, 시스템 클럭, 패스워드, 시스템 날짜와 시간 등이 저장됨.) 에 의해 메모리에 로드되고, 실행된다. 

이 부트로더가 운영체제를 선택하여 실행함. 즉, 운영체제가 한 컴퓨터에 2개 이상 설치되어 있을 경우 사용자에게 선택할 수 있는 기회와 시간을 준다. 

## init프로세스

inint프로세는 etc/init.d/rcS에서 /etc/default/rcS를 호출하고 다시 /etc/rcS.d 디렉터리의 S로 시작되는 파일을 읽은 후 순차적으로 코딩되어 있는 스크립트들을 순서대로 실행함. 

## 자동로그인

root계정이 아닌 일반사용자 계정에서 자동로그인 설정이 가능. 

1. 시스템-관리-로그인 화면 선택
2. 잠금 풀기 버튼 클릭
3. ‘자동으로’를 선택하고 로그인의 다이얼로그를 선택, 계정 선택 박스를 클릭하여 계정 선택

이는 원격로그인에서는 지원되지 않는다. 

## 로그인에 사용되는 파일들

### 로그인 프로그램의 역할

1. 로그인 프로그램은 /etc/issue을 활용하여 로그인 프롬프트를 표시하고, 입력을 대기함. 
2. 사용자가 계정 및 비밀번호를 입력하면 “etc/passwd”파일의 계정과 비교하여 같은 계정이 존재하는지 비교
3. 같은 계정이 존재하는 지 확인
4. /etc/shadow 파일과 비교하여 비밀번호가 맞으면 로그인 절차 시작 

## 운영체제 선택기 조정하기

운영체제 선택기 = 부트로더

부트로더 중 하나인 GRUB 수정하고, 편집해보기

### GRUB

GRUB는 /boot 디렉터리에 마운트 되어 있는 하나의 파일 시스템. 

/boot 파일시스템은 디스크의 MBR을 포함하기 때문에, GRUB는 이 MBR에 위치하고 있는 운영체제 선택기로 /boot/grub/gurb.cfg 파일의 내용을 사용한다. 

우분투에서의 파일은 grub.cfg파일이고, 텍스트 형식이므로 vi 편집기로 수정이 가능하다. 

### 주의 : GRUB는 수정하지 말자

GRUB 수정은 조심해야하며, 정 수정하고 싶으면 다음과 같이 안정장치를 마련하고 수정하자. 

1. menuentry 블록을 복사하여 새로운 메뉴 엔트리를 만들어서 사용
2. 미리미리 grub.cfg 파일을 복사해두자
3. set default = 0에서 0으로 시작하지말고 수정 하지 않는 menuentry의 복구모드를 선택하도록 수정하자

### vi/boot/grub/grub.cfg로 수정하기

위 경로 파일을 열어서 수정이 가능하다. 

```
set default = "0"
//GRUB에서, 나타내는 메뉴 중 몇번쨰 메뉴가 
//기본적으로 선택된 상태로 보일 것이지 설정하는 것
//사용자 입력이 없을 경우, 
//해당 메뉴에서 지정된 운영체제로 시작
```

필요한 메뉴가 몇번째 적혀있는지 확인하고, 해당 번호를 적으면 해당 운영체제가 기본선택으로 됨. 

```
timeout
//몇 초동안 운영체제를 선택할 수 있게 대기할 지
//시간을 정할 수 있음.
```

## 커널 메시지 보기

dmesg라는 명령어를 통해, 커널이 부팅과정에서부터 실행하고 있는 동안에 생성한 메시지를 확인할 수 있다. 

dmesg의 결과물은 굉장히 긴데, 각종 장치 점검 및 프로그램 오류를 검사할 수 있으며, 해커의 해킹 시도까지 감지할 수 있다. 

## Ubuntu 커널 컴파일

우분투에서는 기본적으로 root 가 비활성되어 있어, su 명령어로 루트 권한을 받고 시작해야함. 

```
su root
//루트 권한을 받고 시작

cd/isr/src
//작업을 수행할 디렉터리로 이동

/usr/src#uname-a
//현재 커널 버전을 확인

/usr/src#sudo apt-get install build-essential bin86 kernel-package libncurses5-dev
//커널 컴파일에 필요한 패키지 설치

/usr/src# cd linux-2.6.34
//확인하고

/usr/src# cd linux-2.6.34#ln -s/usr/src/linux-2.6.34/usr/src/linux
//심볼릭 링크를 설정하여, 리눅스 시스템이 기본적으로 찾는
// /usr/src/linux를 만든다. 

~# cd/usr/src/linux
/usr/src/linux#cp /boot/config-'uname -r'.config
//이전 커널에서 사용한 설정 파일을 복사

#make menuconfig
//필요는 모듈이나 설정들을 비활성화시킴
```

kernel hacking에서 엔터를 눌러 세부항목을 표시한다. 

체크 해제를 하고, 저장한다. 

```
#make-kpkg clean
//이전 또는 다운로드한 커널에 존재하고 있을지 모르는
//불필요한 오브젝트 파일을 제거

#make-kpkg --initrd --revision=lgb1 kernel_image modules_image
//우분투에서 커널을 컴파일하는 명령어

이후 완료까지 기다린다. 

# cd/usr/src
dpkg -i linux-image-2.6.34_lgb1_i386.deb
//생성된 커널 이미지를 설치 
```

설치가 완료되면 자동으로 /boot/grub/grub.cfg에 새 버전의 커널이 0번 위치인 맨 앞 쪽 menuentry에 추가됨. 

(실패할 확률을 줄이고자 grub를 수정하여, 0번으로 올라온 새로운 커널 menuconfig를 마지막으로 옮겨놓는 방법도 있음)