# 도커를 사용한 배포

## 기존의 배포 방법

1. 서버 소스코드를 직접 받아 서버에서 빌드 후 실행
2. 빌드 후 실행 파일을 scp로 직접 파일을 전송 후 실행 
3. USB에 직접 파일을 담아 서버로 옮김 후 실행

## 도커

도커는 컨테이너 기반의 가상화 플랫폼으로서, 소프트웨어를 빠르고 안정적으로 개발, 배포, 실행할 수 있도록 지원한다.

서버에서 실행하는 소프트웨어와 그에 필요한 라이브러리, 설정 등 모든 것을 포함한 이미지를 만들고, 독립적인 컨테이너에서 실행함으로써 언제 어디서든 높은 호환성을 유지할 수 있다. 또한 도커를 사용하면 서버 설정 및 라이브러리 관리 등이 간단해지며, 확장성이 높아진다.

## 도커를 사용하는 이유 → “내 컴퓨터에서는 잘 됬는데?” 를 해결

보통 개발자들은 로컬 컴퓨터에서 애플리케이션을 개발하고, 이를 서버에 배포한다. 그러나 로컬 컴퓨터와 서버는 운영 체제(OS), 라이브러리, 의존성 패키지 등의 환경이 달라서 문제가 발생할 수 있는데 도커는 이러한 문제를 해결할 수 있도록  개발시 필요한 라이브러리, 의존성 패키지 등을 모두 도커 이미지에 포함 시키고 개발자는  실행만 하면 된다.

## vmware보다 docker를 사용하는 이유

vmware와 같은 가상머신은 호스트 OS 위에서 다수의 게스트 OS를 구동하는 방식으로 작동한다. 하이퍼바이저를 통해 가상 머신을 실행하기 때문에 가상화 오버헤드가 발생한다. 이에 비해, 도커는 호스트 OS와 커널을 공유하며, 각 컨테이너는 격리된 공간을 가지고 있어 서로 영향을 주지 않는다. 이를 통해 자원을 효율적으로 사용할 수 있으며, 더 빠른 실행 속도와 성능을 제공한다. 이에 따라, 동일한 자원을 사용하더라도 Docker는 VMware보다 더 빠른 성능을 보일 수 있다.

## 도커를 이용한 배포 방법

**로컬**

1. 프로젝트 빌드
2. 도커 파일(Dockerfile) 작성
3. 도커 빌드
4. 이미지 배포

**서버**

1. 도커 이미지 다운로드
2. 컨테이너 실행

### 배포 예시

8080에 요청을 보내면 “Hello World”를 반환하는 간단한 스프링 프로젝트를 생성

```bash
package com.example.demo;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class TestController {

    @RequestMapping("/")
    public String test() {
        return "Hello World!";
    }

}
```

build.gradle에 다음 추가

```bash
jar{
    enabled = false
}
```

프로젝트 빌드

![Untitled](https://user-images.githubusercontent.com/53002135/235449952-2e5d0337-c40f-4f8a-ad68-b260fa384029.png)

도커 파일 작성

프로젝트 최상위 경로에서 도커파일 생성 및 내용 작성

![Untitled](https://user-images.githubusercontent.com/53002135/235449986-5acdf7cf-daa5-444a-b069-a3b026a30de4.png)

도커 로그인

```bash
docker login
```

도커파일 빌드

![Untitled](https://user-images.githubusercontent.com/53002135/235450015-2be04aaa-a08f-4b09-b690-50dacc554362.png)

도커 허브에 업로드

![Untitled](https://user-images.githubusercontent.com/53002135/235450074-a921c2cb-ed74-4ce6-b139-101a53c2871b.png)

![Untitled](https://user-images.githubusercontent.com/53002135/235450102-85a3dea2-2c85-4494-995c-1571f068f045.png)

도커 이미지 다운로드

![Untitled](https://user-images.githubusercontent.com/53002135/235450140-e7126fb2-98e7-47c1-9180-91c83f0c46b6.png)

도커 실행

```bash
docker run --name spring_test -d -p 8080:8080 deankang0918/spring_test:0.1
```

실행 확인

![Untitled](https://user-images.githubusercontent.com/53002135/235450181-47d3e89f-edae-4b39-96bc-615e9e31e92b.png)
