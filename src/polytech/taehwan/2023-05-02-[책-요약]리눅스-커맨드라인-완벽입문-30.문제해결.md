---
layout: post
title: "[책요약]리눅스 커맨드라인 완벽입문_30. 문제해결"
date: 2023-05-02 18:20:32 +0900
comment: true
---

## 이번 장에서는?

- 쉘 스크립트에서 실수를 했을때나, 프로그램이 원치 않는 동작을 할 때 → 무슨일이 벌어지는지 살펴본다.
- 이 장에서는 스크립트에서 발생하는 흔한 오류들과 문제를 찾아 해결하는 방법들을 살펴본다.
- 아래의 쉘스크립트를 가지고 예를 들어볼 것이다.

```bash
# !/bin/bash

# trouble: script to demonstrate common errors

number=1

if [ $number = 1 ]; then
		echo "Number is equal to 1."
else
		echo "Number is not equal to 1."
fi
```

## 구문 오류

- 일반적으로 발생하는 오류 중 하나는 구문적인 것
- 잘못된 타이핑, 오타 등
- 이러한 오류는 쉘에 혼란을 일으킬 수 있다.

### 따옴표 누락

```bash
# !/bin/bash

# trouble: script to demonstrate common errors

number=1

if [ $number = 1 ]; then
		echo "Number is equal to 1.
else
		echo "Number is not equal to 1."
fi
```

![1](https://user-images.githubusercontent.com/47453097/235474148-55b26bbf-1d79-4e8c-9477-ced29dd44872.png)

- 위와 같은 오류가 뜬다. 근데 따옴표가 누락된 곳이 아닌 그 이후의 행 번호를 보고한다.
- bash는 뒤의 따옴표가 어디있나 찾을때 까지 계속 되다가 오류가 나기 때문이다.

- 이러한 오류는 개발자가 찾기 어려우므로, 문법하이라이팅 기능을 사용하면 도움이 될 수 있다.

### 예상치 못한 토큰이나 토큰 누락

- if나 while문 같은 합성 명령어를 제대로 완료하지 않을 때, 나오는 오류

```bash
# !/bin/bash

# trouble: script to demonstrate common errors

number=1

if [ $number = 1 ] then
		echo "Number is equal to 1."
else
		echo "Number is not equal to 1."
fi
```

![2](https://user-images.githubusercontent.com/47453097/235474149-26b9805b-d170-409c-b863-023b65bc4404.png)

- if명령어에서 테스트 후 세미콜론을 제거했다.
- `;` 을 찾을때까지 쉘은 진행한다. 하지만 `예약어` 를 만나게 된다면 멈추고 오류를 뱉게 된다. ;을 만나기 전에 else라는 예약어를 만나서 오류가 났다는 오류이다.

### 예상 외의 확장

- number의 값을 빈 변수로 바꿔보겠다.

```bash
# !/bin/bash

# trouble: script to demonstrate common errors

number=

if [ $number = 1 ]; then
		echo "Number is equal to 1."
else
		echo "Number is not equal to 1."
fi
```

![스크린샷 2023-05-01 23.33.14.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ad844613-76e4-4b45-bce0-6f16fb027d8f/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-05-01_23.33.14.png)

- 값이 없어서 `[  = 1]` 이러한 형태로 된다. 그래서 오류가 뜬다.
- 해결 방법은 if명령어의 test명령을 `[ “$number” = 1 ]` 이렇게 바꿔주게 되면 → `[ “” = 1 ]` 답이 이렇게 나오게 되면서 1이 아니니 else로 갈 것이다.

## 논리 오류

- 논리 오류는 실행 중에 스크립트를 막지 않는다.
- 그래서 정상적으로 실행되기 때문에 에러코드가 뜨지 않아 찾아내기 힘들다.
- 그리고 원하는 결과도 얻을 수 없다.
- 흔히 발견되는 오류들로는
    - 잘못된 조건식 : 그냥 if안에 써야할 로직을 else에 쓴다던가 하는 휴먼에러적인 오류이다.
    - “Off by one” 오류들 : index에러와 비슷하다. 카운터를 사용하여 루프를 코딩할 때, 0부터 시작하는데 1부터 시작하는지 알고 인덱스를 잘못 처리한 오류이다.
    - 예상치 못한 상황들 : 파일 경로 잘못 설정, 파일명 잘못 설정 등 다양하다.

### 방어적 프로그래밍

- 따라서 우리는 미리 논리 오류를 범할 것을 예측하고 가정해서, 프로그래밍을 할 때 방어적으로 해야한다.
- 예를 들어,
    
    ```bash
    cd $dir_name
    rm *
    ```
    
    - 위의 스크립트를 입력하면 잘못된 문법은 아니라 실행된다. 하지만 dir_name이라는 디렉터리가 없다면, 그냥 지금 현재의 경로에서 rm *이 실행되어 원하지 않게 모든 파일들이 삭제될 수도 있다.
    
    ```bash
    [[ -d $dir_name ]] && cd $dir_name && rm *
    ```
    
    - 그래서 위와 같이 스크립트를 입력해야, dir_name이 없으면 다른 분기가 진행이 안된다. 이렇게 미리 논리 오류를 예측한다면 방어적으로 프로그래밍을 할 수 있다.

### 입력 값 검증

- 프로그램이 입력을 받는 경우, 좋은 프로그래밍 규칙은 → 어떤 입력 값이든 처리 가능할 수 있는 프로그램이다.
- 예외처리를 잘 해주라는 뜻이다.

## 테스팅

- 테스팅은 모든 종류의 소프트웨어 개발에서 중요한 단계이다. 쉘 스크립트에서도 이다.

### 스텁(Stub)

- stub이란 토막,꽁초,남은부분,몽당연필.. 이라는 뜻으로
- `stub`은 실제코드나 아직 준비되지 못한 코드를 미리 정해진 답변으로 가장하는 매커니즘입니다.
- 방금 위에서 방어적 프로그래밍을 했던 것과 같다.

- 우리가 코딩을 할 때, 코드의 진행이 눈에 잘 보이지 않아서 중간중간 print문을 많이 껴놓아 확인 했을 것이다.
- 쉘 프로그래밍에서도 같다. 중간중간 echo를 껴놓으므로서 미리 중간결과들을 출력하여 확인하고 오류가 있으면 해결 하는 것이다.
- 또한 테스트를 진행할 때, 테스트에는 도움이 되지만 필요없는 코드들에 주석을 달고, 테스트 후 제거하면 된다.

### 테스트 케이스

- 효과적인 테스트를 위해서는 좋은 테스트 케이스를 개발하고 적용해야 한다.
- 테스트 케이스는 엣지케이스(edge case)와 코너 케이스(corner case)를 반영하여 입력 데이터와 작동 상태를 주의 깊게 선택하는 것으로 이루어진다.
- 다음 세가지 상황을 가정하여 코드가 어떻게 수행되는지 알아보려고 한다.
    - dir_name이 존재하는 디렉토리를 포함한 경우
    - dir_name이 존재하지 않는 디렉토리를 포함한 경우
    - dir_name이 비어있는 경우
- 이렇게 미리 상황을 가정하는 것이 테스트케이스를 만드는 것이고 → 각각 테스트 하여 좋은 테스트 커버리지를 만들 수 있다.

## 디버깅

- 테스팅을 해서 스크립트의 문제를 알아냈다면, 디버깅을 해야한다.
- 디버깅에서는 왜 이 스크립트에 오류(문제)가 발생하는지, 내부 동작을 주의 깊게 확인할 필요가 있다.

### 문제 발생 지역 발견

- 긴 스크립트에서는 문제가 되는 스크립트 영역만을 집중할 수 있게 격리시키는 것이 중요하다.
- 코드를 격리시키는데 사용하는 한 가지 기법은 → 집중할 코드를 제외하고는 주석처리 하는 것이다.

### 트레이싱(tracing)

- 버그는 종종 스크립트내에서 예상치 못한 논리적 흐름일 경우가 많다.
- 잘못된 순서로 동작되거나, 아예 실행되지 않는 부분이 있거나 하는 등의 경우이다.
- 그래서 Stub기법과 비슷하게 중간중간에 echo를 껴놓을 것이다. 근데 echo를 더 구체적으로 이 부분은 어떤 부분이다 라는 메시지를 넣어줄 것이다. 이것이 바로 트레이싱이다.

### 실행 중 값 확인

- 트레이싱 기법과 유사하다.
- 차이점은 echo명령문을 사용하여 값을 확인하는 메세지를 넣는 것이다.

## 마무리 노트

- 이 장에서는 스크립트 개발 중 나타나는 몇몇 문제(오류)들을 살펴봤다.
- 물론 더 많은 오류들이 존재한다. 하지만 테스트기법과 디버깅기법으로 오류의 확률을 낮출 수 있게 방어적으로 프로그래밍 할 수 있게 생각하는 법을 알 수 있는 장이었다.